<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Starting a Web Server in your Cluster
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="An open source framework for large-scale distributed computation and data processing written in F#."/>
    <meta name="author" content="Jan Dzik, Nick Palladinos, Kostas Rontogiannis, Eirik Tsarpalis"/>
    
    <script src="https://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="https://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet"/>

    <link rel="icon" type="image/png" href="http://www.m-brace.net/img/favicon-196x196.png" sizes="196x196"/>
    <link rel="icon" type="image/png" href="http://www.m-brace.net/img/favicon-160x160.png" sizes="160x160"/>
    <link rel="icon" type="image/png" href="http://www.m-brace.net/img/favicon-96x96.png" sizes="96x96"/>
    <link rel="icon" type="image/png" href="http://www.m-brace.net/img/favicon-16x16.png" sizes="16x16"/>
    <link rel="icon" type="image/png" href="http://www.m-brace.net/img/favicon-32x32.png" sizes="32x32"/>

    <link type="text/css" rel="stylesheet" href="http://www.m-brace.net/content/style.css" />
    <script type="text/javascript" src="http://www.m-brace.net/content/tips.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="https://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="http://nessos.github.io">nessos</a></li>
          <li><a href="http://github.com/mbraceproject/MBrace.Core">github page</a></li>
        </ul>
        <h3 class="muted"><a href="http://www.m-brace.net/index.html">MBrace</a></h3>
      </div>
      <hr />
      <div class="row">
        <div class="span9" id="main">
          
<h1><a name="Starting-a-Web-Server-in-your-Cluster" class="anchor" href="#Starting-a-Web-Server-in-your-Cluster">Starting a Web Server in your Cluster</a></h1>

<p>This tutorial illustrates creating a cloud process which 
acts as a web server to monitor the cluster.
*</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
<span class="l">9: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="prep">#load</span> <span class="s">&quot;webserver.fsx&quot;</span>

<span class="k">open</span> <span class="i">Suave</span>
<span class="k">open</span> <span class="i">Suave</span><span class="o">.</span><span class="i">Types</span>
<span class="k">open</span> <span class="i">Suave</span><span class="o">.</span><span class="i">Http</span>
<span class="k">open</span> <span class="i">Suave</span><span class="o">.</span><span class="i">Http</span><span class="o">.</span><span class="i">Applicatives</span>
<span class="k">open</span> <span class="i">Suave</span><span class="o">.</span><span class="i">Http</span><span class="o">.</span><span class="i">Successful</span>
<span class="k">open</span> <span class="i">Suave</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs5', 6)" onmouseover="showTip(event, 'fs5', 6)" class="i">Web</span>
<span class="k">open</span> <span onmouseout="hideTip(event, 'fs6', 7)" onmouseover="showTip(event, 'fs6', 7)" class="i">Webserver</span>
</pre>
</td>
</tr>
</table>

<p>This Suave request is executed in response to a GET on</p>

<p><a href="http://nn.nn.nn.nn/cluster/workers">http://nn.nn.nn.nn/cluster/workers</a></p>

<p>It uses cluster.GetWorkers to access information from the cluster.</p>

<p>This is the Suave specification for the web server we will run in the cluster:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs7', 8)" onmouseover="showTip(event, 'fs7', 8)" class="f">helloRequest</span> <span onmouseout="hideTip(event, 'fs8', 9)" onmouseover="showTip(event, 'fs8', 9)" class="i">ctxt</span> <span class="o">=</span> 
    <span onmouseout="hideTip(event, 'fs9', 10)" onmouseover="showTip(event, 'fs9', 10)" class="i">async</span> { <span class="k">return!</span> <span class="i">OK</span> <span class="s">&quot;hello&quot;</span> <span onmouseout="hideTip(event, 'fs8', 11)" onmouseover="showTip(event, 'fs8', 11)" class="i">ctxt</span> }

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs10', 12)" onmouseover="showTip(event, 'fs10', 12)" class="f">getCluster</span>() <span class="o">=</span> 
    <span onmouseout="hideTip(event, 'fs4', 13)" onmouseover="showTip(event, 'fs4', 13)" class="i">Runtime</span><span class="o">.</span><span class="i">GetHandle</span>(<span onmouseout="hideTip(event, 'fs11', 14)" onmouseover="showTip(event, 'fs11', 14)" class="i">config</span>) 
</pre>
</td>
</tr>
</table>

<p>This Suave request is executed in response to a GET on</p>

<p><a href="http://nn.nn.nn.nn/">http://nn.nn.nn.nn/</a></p>

<p>It uses cluster.GetWorkers to access information from the cluster.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs12', 15)" onmouseover="showTip(event, 'fs12', 15)" class="f">getWorkersRequest</span> <span onmouseout="hideTip(event, 'fs8', 16)" onmouseover="showTip(event, 'fs8', 16)" class="i">ctxt</span> <span class="o">=</span> 
    <span onmouseout="hideTip(event, 'fs9', 17)" onmouseover="showTip(event, 'fs9', 17)" class="i">async</span> { <span class="k">let</span> <span onmouseout="hideTip(event, 'fs13', 18)" onmouseover="showTip(event, 'fs13', 18)" class="i">cluster</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs10', 19)" onmouseover="showTip(event, 'fs10', 19)" class="f">getCluster</span>()
            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs14', 20)" onmouseover="showTip(event, 'fs14', 20)" class="i">workers</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs13', 21)" onmouseover="showTip(event, 'fs13', 21)" class="i">cluster</span><span class="o">.</span><span class="i">GetWorkers</span>() <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs15', 22)" onmouseover="showTip(event, 'fs15', 22)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs16', 23)" onmouseover="showTip(event, 'fs16', 23)" class="f">toArray</span>
            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs17', 24)" onmouseover="showTip(event, 'fs17', 24)" class="i">msg</span> <span class="o">=</span> 
              [ <span class="k">yield</span> <span class="s">&quot;&lt;html&gt;&quot;</span>
                <span class="k">yield</span> <span onmouseout="hideTip(event, 'fs18', 25)" onmouseover="showTip(event, 'fs18', 25)" class="t">Angular</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs19', 26)" onmouseover="showTip(event, 'fs19', 26)" class="i">header</span>
                <span class="k">yield</span> <span class="s">&quot;&lt;body&gt;&quot;</span>
                <span class="k">yield!</span> <span onmouseout="hideTip(event, 'fs14', 27)" onmouseover="showTip(event, 'fs14', 27)" class="i">workers</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs18', 28)" onmouseover="showTip(event, 'fs18', 28)" class="t">Angular</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs20', 29)" onmouseover="showTip(event, 'fs20', 29)" class="f">table</span> [<span class="s">&quot;ID&quot;</span>;<span class="s">&quot;Heartbeat&quot;</span>] (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs21', 30)" onmouseover="showTip(event, 'fs21', 30)" class="i">w</span> <span class="k">-&gt;</span> 
                    [ <span onmouseout="hideTip(event, 'fs21', 31)" onmouseover="showTip(event, 'fs21', 31)" class="i">w</span><span class="o">.</span><span class="i">Id</span>; <span onmouseout="hideTip(event, 'fs22', 32)" onmouseover="showTip(event, 'fs22', 32)" class="f">sprintf</span> <span class="s">&quot;</span><span class="pf">%A</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs21', 33)" onmouseover="showTip(event, 'fs21', 33)" class="i">w</span><span class="o">.</span><span class="i">HeartbeatTime</span> ])
                <span class="k">yield</span> <span class="s">&quot;&lt;/body&gt;&quot;</span>
                <span class="k">yield</span> <span class="s">&quot;&lt;/html&gt;&quot;</span> ]
              <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs23', 34)" onmouseover="showTip(event, 'fs23', 34)" class="t">String</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs24', 35)" onmouseover="showTip(event, 'fs24', 35)" class="f">concat</span> <span class="s">&quot;</span><span class="e">\n</span><span class="s">&quot;</span>
            <span class="k">let!</span> <span onmouseout="hideTip(event, 'fs25', 36)" onmouseover="showTip(event, 'fs25', 36)" class="i">rsp</span> <span class="o">=</span> <span class="i">OK</span> <span onmouseout="hideTip(event, 'fs17', 37)" onmouseover="showTip(event, 'fs17', 37)" class="i">msg</span> <span onmouseout="hideTip(event, 'fs8', 38)" onmouseover="showTip(event, 'fs8', 38)" class="i">ctxt</span> 
            <span class="k">return</span> <span onmouseout="hideTip(event, 'fs25', 39)" onmouseover="showTip(event, 'fs25', 39)" class="i">rsp</span>}
</pre>
</td>
</tr>
</table>

<p>This Suave request is executed in response to a GET on 
   <a href="http://nn.nn.nn.nn/cluster/logs">http://nn.nn.nn.nn/cluster/logs</a></p>

<p>It uses cluster.GetLogs to access information from the cluster.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
<span class="l">31: </span>
<span class="l">32: </span>
<span class="l">33: </span>
<span class="l">34: </span>
<span class="l">35: </span>
<span class="l">36: </span>
<span class="l">37: </span>
<span class="l">38: </span>
<span class="l">39: </span>
<span class="l">40: </span>
<span class="l">41: </span>
<span class="l">42: </span>
<span class="l">43: </span>
<span class="l">44: </span>
<span class="l">45: </span>
<span class="l">46: </span>
<span class="l">47: </span>
<span class="l">48: </span>
<span class="l">49: </span>
<span class="l">50: </span>
<span class="l">51: </span>
<span class="l">52: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs26', 40)" onmouseover="showTip(event, 'fs26', 40)" class="f">getLogsRequest</span> <span onmouseout="hideTip(event, 'fs8', 41)" onmouseover="showTip(event, 'fs8', 41)" class="i">ctxt</span> <span class="o">=</span> 
    <span onmouseout="hideTip(event, 'fs9', 42)" onmouseover="showTip(event, 'fs9', 42)" class="i">async</span> { <span class="k">let</span> <span onmouseout="hideTip(event, 'fs13', 43)" onmouseover="showTip(event, 'fs13', 43)" class="i">cluster</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs10', 44)" onmouseover="showTip(event, 'fs10', 44)" class="f">getCluster</span>()
            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs27', 45)" onmouseover="showTip(event, 'fs27', 45)" class="i">logs</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs13', 46)" onmouseover="showTip(event, 'fs13', 46)" class="i">cluster</span><span class="o">.</span><span class="i">GetLogs</span>()
            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs17', 47)" onmouseover="showTip(event, 'fs17', 47)" class="i">msg</span> <span class="o">=</span> 
              [ <span class="k">yield</span> <span class="s">&quot;&lt;html&gt;&quot;</span>
                <span class="k">yield</span> <span onmouseout="hideTip(event, 'fs18', 48)" onmouseover="showTip(event, 'fs18', 48)" class="t">Angular</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs19', 49)" onmouseover="showTip(event, 'fs19', 49)" class="i">header</span>
                <span class="k">yield</span> <span class="s">&quot;&lt;body&gt;&quot;</span>
                <span class="k">yield!</span> <span onmouseout="hideTip(event, 'fs27', 50)" onmouseover="showTip(event, 'fs27', 50)" class="i">logs</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs18', 51)" onmouseover="showTip(event, 'fs18', 51)" class="t">Angular</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs20', 52)" onmouseover="showTip(event, 'fs20', 52)" class="f">table</span> [<span class="s">&quot;Time&quot;</span>;<span class="s">&quot;Message&quot;</span>] (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs21', 53)" onmouseover="showTip(event, 'fs21', 53)" class="i">w</span> <span class="k">-&gt;</span> 
                    [ <span onmouseout="hideTip(event, 'fs22', 54)" onmouseover="showTip(event, 'fs22', 54)" class="f">sprintf</span> <span class="s">&quot;</span><span class="pf">%A</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs21', 55)" onmouseover="showTip(event, 'fs21', 55)" class="i">w</span><span class="o">.</span><span class="i">Time</span>; <span onmouseout="hideTip(event, 'fs21', 56)" onmouseover="showTip(event, 'fs21', 56)" class="i">w</span><span class="o">.</span><span class="i">Message</span> ])
                <span class="k">yield</span> <span class="s">&quot;&lt;/body&gt;&quot;</span>
                <span class="k">yield</span> <span class="s">&quot;&lt;/html&gt;&quot;</span> ]
              <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs23', 57)" onmouseover="showTip(event, 'fs23', 57)" class="t">String</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs24', 58)" onmouseover="showTip(event, 'fs24', 58)" class="f">concat</span> <span class="s">&quot;</span><span class="e">\n</span><span class="s">&quot;</span>
            <span class="k">return!</span> <span class="i">OK</span> <span class="i">msg</span> <span onmouseout="hideTip(event, 'fs8', 59)" onmouseover="showTip(event, 'fs8', 59)" class="i">ctxt</span>  }

<span class="c">// This Suave request is executed in response to a GET on </span>
<span class="c">//   http://nn.nn.nn.nn/cluster/submit/primes/%d</span>
<span class="c">//</span>
<span class="c">// It uses cluster.CreateProcess to create a new job in the cluster.</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs28', 60)" onmouseover="showTip(event, 'fs28', 60)" class="f">computePrimesRequest</span> <span onmouseout="hideTip(event, 'fs29', 61)" onmouseover="showTip(event, 'fs29', 61)" class="i">n</span> <span onmouseout="hideTip(event, 'fs30', 62)" onmouseover="showTip(event, 'fs30', 62)" class="i">ctxt</span> <span class="o">=</span> 
    <span onmouseout="hideTip(event, 'fs9', 63)" onmouseover="showTip(event, 'fs9', 63)" class="i">async</span> { <span class="k">let</span> <span onmouseout="hideTip(event, 'fs13', 64)" onmouseover="showTip(event, 'fs13', 64)" class="i">cluster</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs10', 65)" onmouseover="showTip(event, 'fs10', 65)" class="f">getCluster</span>()
            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs31', 66)" onmouseover="showTip(event, 'fs31', 66)" class="i">logs</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs13', 67)" onmouseover="showTip(event, 'fs13', 67)" class="i">cluster</span><span class="o">.</span><span class="i">GetLogs</span>()
            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs32', 68)" onmouseover="showTip(event, 'fs32', 68)" class="i">job</span> <span class="o">=</span> 
              <span onmouseout="hideTip(event, 'fs13', 69)" onmouseover="showTip(event, 'fs13', 69)" class="i">cluster</span><span class="o">.</span><span class="i">CreateProcess</span> 
                (<span class="i">cloud</span> { <span class="k">let</span> <span class="i">primes</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs33', 70)" onmouseover="showTip(event, 'fs33', 70)" class="i">Sieve</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs34', 71)" onmouseover="showTip(event, 'fs34', 71)" class="i">getPrimes</span> <span onmouseout="hideTip(event, 'fs29', 72)" onmouseover="showTip(event, 'fs29', 72)" class="i">n</span>
                         <span class="k">return</span> <span onmouseout="hideTip(event, 'fs22', 73)" onmouseover="showTip(event, 'fs22', 73)" class="i">sprintf</span> <span class="s">&quot;calculated %d primes: %A&quot;</span> <span class="i">primes</span><span class="o">.</span><span class="i">Length</span> <span class="i">primes</span> })
            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs17', 74)" onmouseover="showTip(event, 'fs17', 74)" class="i">msg</span> <span class="o">=</span> 
              [ <span class="k">yield</span> <span class="s">&quot;&lt;html&gt;&quot;</span>
                <span class="k">yield</span> <span onmouseout="hideTip(event, 'fs18', 75)" onmouseover="showTip(event, 'fs18', 75)" class="t">Angular</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs19', 76)" onmouseover="showTip(event, 'fs19', 76)" class="i">header</span>
                <span class="k">yield</span> <span class="s">&quot;&lt;body&gt;&quot;</span>
                <span class="k">yield</span> (<span onmouseout="hideTip(event, 'fs22', 77)" onmouseover="showTip(event, 'fs22', 77)" class="f">sprintf</span> <span class="s">&quot;&lt;p&gt;Created job </span><span class="pf">%s</span><span class="s">&lt;/p&gt;&quot;</span> <span onmouseout="hideTip(event, 'fs32', 78)" onmouseover="showTip(event, 'fs32', 78)" class="i">job</span><span class="o">.</span><span class="i">Id</span>)
                <span class="k">yield</span> <span class="s">&quot;&lt;/body&gt;&quot;</span>
                <span class="k">yield</span> <span class="s">&quot;&lt;/html&gt;&quot;</span> ]
              <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs23', 79)" onmouseover="showTip(event, 'fs23', 79)" class="t">String</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs24', 80)" onmouseover="showTip(event, 'fs24', 80)" class="f">concat</span> <span class="s">&quot;</span><span class="e">\n</span><span class="s">&quot;</span>
            <span class="k">return!</span> <span class="i">OK</span> <span onmouseout="hideTip(event, 'fs17', 81)" onmouseover="showTip(event, 'fs17', 81)" class="i">msg</span> <span onmouseout="hideTip(event, 'fs30', 82)" onmouseover="showTip(event, 'fs30', 82)" class="i">ctxt</span>  }

<span class="c">// This Suave request is executed in response to a GET on </span>
<span class="c">//   http://nn.nn.nn.nn/cluster/job/%d</span>
<span class="c">//</span>
<span class="c">// It uses cluster.GetProcess to create a new job in the cluster.</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs35', 83)" onmouseover="showTip(event, 'fs35', 83)" class="f">getJobRequest</span> <span onmouseout="hideTip(event, 'fs36', 84)" onmouseover="showTip(event, 'fs36', 84)" class="i">v</span> <span onmouseout="hideTip(event, 'fs30', 85)" onmouseover="showTip(event, 'fs30', 85)" class="i">ctxt</span> <span class="o">=</span> 
    <span onmouseout="hideTip(event, 'fs9', 86)" onmouseover="showTip(event, 'fs9', 86)" class="i">async</span> { <span class="k">let</span> <span onmouseout="hideTip(event, 'fs13', 87)" onmouseover="showTip(event, 'fs13', 87)" class="i">cluster</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs10', 88)" onmouseover="showTip(event, 'fs10', 88)" class="f">getCluster</span>()
            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs31', 89)" onmouseover="showTip(event, 'fs31', 89)" class="i">logs</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs13', 90)" onmouseover="showTip(event, 'fs13', 90)" class="i">cluster</span><span class="o">.</span><span class="i">GetLogs</span>()
            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs32', 91)" onmouseover="showTip(event, 'fs32', 91)" class="i">job</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs13', 92)" onmouseover="showTip(event, 'fs13', 92)" class="i">cluster</span><span class="o">.</span><span class="i">GetProcess</span>(<span onmouseout="hideTip(event, 'fs36', 93)" onmouseover="showTip(event, 'fs36', 93)" class="i">v</span>)
            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs17', 94)" onmouseover="showTip(event, 'fs17', 94)" class="i">msg</span> <span class="o">=</span> 
                [ <span class="k">yield</span> <span class="s">&quot;&lt;html&gt;&quot;</span>
                  <span class="k">yield</span> <span onmouseout="hideTip(event, 'fs18', 95)" onmouseover="showTip(event, 'fs18', 95)" class="t">Angular</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs19', 96)" onmouseover="showTip(event, 'fs19', 96)" class="i">header</span>
                  <span class="k">yield</span> <span class="s">&quot;&lt;body&gt;&quot;</span>
                  <span class="k">yield</span> (<span onmouseout="hideTip(event, 'fs22', 97)" onmouseover="showTip(event, 'fs22', 97)" class="f">sprintf</span> <span class="s">&quot;&lt;p&gt;Job </span><span class="pf">%s</span><span class="s">, Completed: </span><span class="pf">%A</span><span class="s">, Result: </span><span class="pf">%s</span><span class="s">&lt;/p&gt;&quot;</span> <span onmouseout="hideTip(event, 'fs32', 98)" onmouseover="showTip(event, 'fs32', 98)" class="i">job</span><span class="o">.</span><span class="i">Id</span> <span onmouseout="hideTip(event, 'fs32', 99)" onmouseover="showTip(event, 'fs32', 99)" class="i">job</span><span class="o">.</span><span class="i">Completed</span> (<span class="k">try</span> <span class="k">if</span> <span onmouseout="hideTip(event, 'fs32', 100)" onmouseover="showTip(event, 'fs32', 100)" class="i">job</span><span class="o">.</span><span class="i">Completed</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs22', 101)" onmouseover="showTip(event, 'fs22', 101)" class="f">sprintf</span> <span class="s">&quot;</span><span class="pf">%A</span><span class="s">&quot;</span> (<span onmouseout="hideTip(event, 'fs32', 102)" onmouseover="showTip(event, 'fs32', 102)" class="i">job</span><span class="o">.</span><span class="i">AwaitResultBoxed</span>()) <span class="k">else</span> <span class="s">&quot;&quot;</span> <span class="k">with</span> _ <span class="k">-&gt;</span> <span class="s">&quot;&lt;err&gt;&quot;</span>) )
                  <span class="k">yield</span> <span class="s">&quot;&lt;/body&gt;&quot;</span>
                  <span class="k">yield</span> <span class="s">&quot;&lt;/html&gt;&quot;</span> ]
                <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs23', 103)" onmouseover="showTip(event, 'fs23', 103)" class="t">String</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs24', 104)" onmouseover="showTip(event, 'fs24', 104)" class="f">concat</span> <span class="s">&quot;</span><span class="e">\n</span><span class="s">&quot;</span>
            <span class="k">return!</span> <span class="i">OK</span> <span class="i">msg</span> <span onmouseout="hideTip(event, 'fs30', 105)" onmouseover="showTip(event, 'fs30', 105)" class="i">ctxt</span>  }
</pre>
</td>
</tr>
</table>

<p>Now the overall specification of the server:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs37', 106)" onmouseover="showTip(event, 'fs37', 106)" class="f">webServerSpec</span> () <span class="o">=</span>
  <span class="i">choose</span>
    [ <span class="i">GET</span> <span class="o">&gt;</span><span class="o">&gt;</span><span class="o">=</span> <span class="i">choose</span>
                [ <span class="i">path</span> <span class="s">&quot;/&quot;</span> <span class="o">&gt;</span><span class="o">&gt;</span><span class="o">=</span> <span class="i">OK</span> <span class="s">&quot;Welcome to the cluster&quot;</span> 
                  <span class="i">path</span> <span class="s">&quot;/cluster/workers&quot;</span> <span class="o">&gt;</span><span class="o">&gt;</span><span class="o">=</span> <span onmouseout="hideTip(event, 'fs12', 107)" onmouseover="showTip(event, 'fs12', 107)" class="i">getWorkersRequest</span>
                  <span class="i">path</span> <span class="s">&quot;/cluster/logs&quot;</span> <span class="o">&gt;</span><span class="o">&gt;</span><span class="o">=</span> <span onmouseout="hideTip(event, 'fs26', 108)" onmouseover="showTip(event, 'fs26', 108)" class="i">getLogsRequest</span>
                  <span class="i">pathScan</span> <span class="s">&quot;/cluster/job/%s&quot;</span> <span onmouseout="hideTip(event, 'fs35', 109)" onmouseover="showTip(event, 'fs35', 109)" class="i">getJobRequest</span>
                  <span class="i">pathScan</span> <span class="s">&quot;/cluster/submit/primes/%d&quot;</span> <span onmouseout="hideTip(event, 'fs28', 110)" onmouseover="showTip(event, 'fs28', 110)" class="i">computePrimesRequest</span> ]
      <span class="i">POST</span> <span class="o">&gt;</span><span class="o">&gt;</span><span class="o">=</span> <span class="i">choose</span>
                [ <span class="i">path</span> <span class="s">&quot;/hello&quot;</span> <span class="o">&gt;</span><span class="o">&gt;</span><span class="o">=</span> <span class="i">OK</span> <span class="s">&quot;Hello POST&quot;</span>
                  <span class="i">path</span> <span class="s">&quot;/goodbye&quot;</span> <span class="o">&gt;</span><span class="o">&gt;</span><span class="o">=</span> <span class="i">OK</span> <span class="s">&quot;Good bye POST&quot;</span> ] ]
</pre>
</td>
</tr>
</table>

<p>Now connect to the cluster:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs38', 111)" onmouseover="showTip(event, 'fs38', 111)" class="i">cluster</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs4', 112)" onmouseover="showTip(event, 'fs4', 112)" class="i">Runtime</span><span class="o">.</span><span class="i">GetHandle</span>(<span onmouseout="hideTip(event, 'fs11', 113)" onmouseover="showTip(event, 'fs11', 113)" class="i">config</span>)

<span onmouseout="hideTip(event, 'fs38', 114)" onmouseover="showTip(event, 'fs38', 114)" class="i">cluster</span><span class="o">.</span><span class="i">ShowProcesses</span>()

<span class="c">// Use this to inspect the endpoints we can bind to in the cluster</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs39', 115)" onmouseover="showTip(event, 'fs39', 115)" class="i">endPointNames</span> <span class="o">=</span> 
    <span class="i">cloud</span> { <span class="k">return</span> <span onmouseout="hideTip(event, 'fs40', 116)" onmouseover="showTip(event, 'fs40', 116)" class="i">Microsoft</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs41', 117)" onmouseover="showTip(event, 'fs41', 117)" class="i">WindowsAzure</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs42', 118)" onmouseover="showTip(event, 'fs42', 118)" class="i">ServiceRuntime</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs43', 119)" onmouseover="showTip(event, 'fs43', 119)" class="i">RoleEnvironment</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs44', 120)" onmouseover="showTip(event, 'fs44', 120)" class="i">CurrentRoleInstance</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs45', 121)" onmouseover="showTip(event, 'fs45', 121)" class="i">InstanceEndpoints</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs46', 122)" onmouseover="showTip(event, 'fs46', 122)" class="i">Keys</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs15', 123)" onmouseover="showTip(event, 'fs15', 123)" class="i">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs16', 124)" onmouseover="showTip(event, 'fs16', 124)" class="i">toArray</span> }
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs38', 125)" onmouseover="showTip(event, 'fs38', 125)" class="i">cluster</span><span class="o">.</span><span class="i">Run</span>
</pre>
</td>
</tr>
</table>

<p>By default, MBrace.Azure clusters created using Brisk engine on Azure allow us to bind to</p>

<ul>
<li>HTTP endpoint 'DefaultHttpEndpoint'</li>
<li>HTTP endpoint 'MBraceStats'</li>
<li>TCP endpoint 'DefaultTcpEndpoint'</li>
</ul>

<p>Here we bind to DefaultHttpEndpoint.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs47', 126)" onmouseover="showTip(event, 'fs47', 126)" class="i">serverJob</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs48', 127)" onmouseover="showTip(event, 'fs48', 127)" class="f">suaveServerInCloud</span> <span class="s">&quot;DefaultHttpEndpoint&quot;</span> <span onmouseout="hideTip(event, 'fs37', 128)" onmouseover="showTip(event, 'fs37', 128)" class="f">webServerSpec</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs38', 129)" onmouseover="showTip(event, 'fs38', 129)" class="i">cluster</span><span class="o">.</span><span class="i">CreateProcess</span>
</pre>
</td>
</tr>
</table>

<p>After you start the webserver (by binding to this internal endpoint), the website will 
be published to the corresponding public endpoint. You can find the IP
address or URL for the public endpoint by looking for 'Input Endpoints'
in the 'Configuration' section of the Azure management console page for the 
Cloud Service for the MBrace cluster.</p>

<p>For example, the public URL for the MBraceWorkerRole may be <a href="http://191.233.103.54:80
*)">http://191.233.103.54:80
*)</a></p>

<p>(<em></em> Use this to inspect the status of the web server job:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span onmouseout="hideTip(event, 'fs47', 130)" onmouseover="showTip(event, 'fs47', 130)" class="i">serverJob</span><span class="o">.</span><span class="i">ShowInfo</span>()

<span class="c">(** If the webserver doesn&#39;t start, then use this to see the logging output from webserver.fsx: *)</span> 

<span onmouseout="hideTip(event, 'fs47', 131)" onmouseover="showTip(event, 'fs47', 131)" class="i">serverJob</span><span class="o">.</span><span class="i">ShowLogs</span>()
</pre>
</td>
</tr>
</table>

<p>Use this to cancel the web server (via the distributed cancellationToken being cancelled):</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="c">// serverJob.Kill()</span>
</pre>
</td>
</tr>
</table>

<p>Use this to wait for the web server to exit after cancellation:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="c">// serverJob.AwaitResult()</span>
</pre>
</td>
</tr>
</table>

<div class="tip" id="fs1">namespace System</div>
<div class="tip" id="fs2">namespace System.IO</div>
<div class="tip" id="fs3">namespace Microsoft.FSharp.Core</div>
<div class="tip" id="fs4">namespace System.Runtime</div>
<div class="tip" id="fs5">namespace System.Web</div>
<div class="tip" id="fs6">module Webserver</div>
<div class="tip" id="fs7">val helloRequest : ctxt:&#39;a -&gt; Async&lt;&#39;b&gt;<br /><br />Full name: 200-starting-a-web-server.helloRequest</div>
<div class="tip" id="fs8">val ctxt : &#39;a</div>
<div class="tip" id="fs9">val async : AsyncBuilder<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.async</div>
<div class="tip" id="fs10">val getCluster : unit -&gt; &#39;a<br /><br />Full name: 200-starting-a-web-server.getCluster</div>
<div class="tip" id="fs11">val config : obj<br /><br />Full name: ConnectionStrings.config</div>
<div class="tip" id="fs12">val getWorkersRequest : ctxt:&#39;a -&gt; Async&lt;&#39;b&gt;<br /><br />Full name: 200-starting-a-web-server.getWorkersRequest</div>
<div class="tip" id="fs13">val cluster : obj</div>
<div class="tip" id="fs14">val workers : obj []</div>
<div class="tip" id="fs15">module Seq<br /><br />from Microsoft.FSharp.Collections</div>
<div class="tip" id="fs16">val toArray : source:seq&lt;&#39;T&gt; -&gt; &#39;T []<br /><br />Full name: Microsoft.FSharp.Collections.Seq.toArray</div>
<div class="tip" id="fs17">val msg : string</div>
<div class="tip" id="fs18">module Angular<br /><br />from Webserver</div>
<div class="tip" id="fs19">val header : string<br /><br />Full name: Webserver.Angular.header</div>
<div class="tip" id="fs20">val table : hs:seq&lt;string&gt; -&gt; f:(&#39;T -&gt; #seq&lt;string&gt;) -&gt; xs:seq&lt;&#39;T&gt; -&gt; string list<br /><br />Full name: Webserver.Angular.table</div>
<div class="tip" id="fs21">val w : obj</div>
<div class="tip" id="fs22">val sprintf : format:Printf.StringFormat&lt;&#39;T&gt; -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.sprintf</div>
<div class="tip" id="fs23">Multiple items<br />type String =<br />&#160;&#160;new : value:char -&gt; string + 7 overloads<br />&#160;&#160;member Chars : int -&gt; char<br />&#160;&#160;member Clone : unit -&gt; obj<br />&#160;&#160;member CompareTo : value:obj -&gt; int + 1 overload<br />&#160;&#160;member Contains : value:string -&gt; bool<br />&#160;&#160;member CopyTo : sourceIndex:int * destination:char[] * destinationIndex:int * count:int -&gt; unit<br />&#160;&#160;member EndsWith : value:string -&gt; bool + 2 overloads<br />&#160;&#160;member Equals : obj:obj -&gt; bool + 2 overloads<br />&#160;&#160;member GetEnumerator : unit -&gt; CharEnumerator<br />&#160;&#160;member GetHashCode : unit -&gt; int<br />&#160;&#160;...<br /><br />Full name: System.String<br /><br />--------------------<br />String(value: nativeptr&lt;char&gt;) : unit<br />String(value: nativeptr&lt;sbyte&gt;) : unit<br />String(value: char []) : unit<br />String(c: char, count: int) : unit<br />String(value: nativeptr&lt;char&gt;, startIndex: int, length: int) : unit<br />String(value: nativeptr&lt;sbyte&gt;, startIndex: int, length: int) : unit<br />String(value: char [], startIndex: int, length: int) : unit<br />String(value: nativeptr&lt;sbyte&gt;, startIndex: int, length: int, enc: Text.Encoding) : unit</div>
<div class="tip" id="fs24">val concat : sep:string -&gt; strings:seq&lt;string&gt; -&gt; string<br /><br />Full name: Microsoft.FSharp.Core.String.concat</div>
<div class="tip" id="fs25">val rsp : &#39;b</div>
<div class="tip" id="fs26">val getLogsRequest : ctxt:&#39;a -&gt; Async&lt;&#39;b&gt;<br /><br />Full name: 200-starting-a-web-server.getLogsRequest</div>
<div class="tip" id="fs27">val logs : seq&lt;obj&gt;</div>
<div class="tip" id="fs28">val computePrimesRequest : n:&#39;a -&gt; ctxt:&#39;b -&gt; Async&lt;&#39;c&gt;<br /><br />Full name: 200-starting-a-web-server.computePrimesRequest</div>
<div class="tip" id="fs29">val n : &#39;a</div>
<div class="tip" id="fs30">val ctxt : &#39;b</div>
<div class="tip" id="fs31">val logs : obj</div>
<div class="tip" id="fs32">val job : obj</div>
<div class="tip" id="fs33">module Sieve</div>
<div class="tip" id="fs34">val getPrimes : nmax:int -&gt; int []<br /><br />Full name: Sieve.getPrimes</div>
<div class="tip" id="fs35">val getJobRequest : v:&#39;a -&gt; ctxt:&#39;b -&gt; Async&lt;&#39;c&gt;<br /><br />Full name: 200-starting-a-web-server.getJobRequest</div>
<div class="tip" id="fs36">val v : &#39;a</div>
<div class="tip" id="fs37">val webServerSpec : unit -&gt; &#39;a<br /><br />Full name: 200-starting-a-web-server.webServerSpec</div>
<div class="tip" id="fs38">val cluster : obj<br /><br />Full name: 200-starting-a-web-server.cluster</div>
<div class="tip" id="fs39">val endPointNames : obj<br /><br />Full name: 200-starting-a-web-server.endPointNames</div>
<div class="tip" id="fs40">namespace Microsoft</div>
<div class="tip" id="fs41">namespace Microsoft.WindowsAzure</div>
<div class="tip" id="fs42">namespace Microsoft.WindowsAzure.ServiceRuntime</div>
<div class="tip" id="fs43">type RoleEnvironment =<br />&#160;&#160;static val TraceSource : TraceSource<br />&#160;&#160;static member CurrentRoleInstance : RoleInstance<br />&#160;&#160;static member DeploymentId : string<br />&#160;&#160;static member GetConfigurationSettingValue : configurationSettingName:string -&gt; string<br />&#160;&#160;static member GetLocalResource : localResourceName:string -&gt; LocalResource<br />&#160;&#160;static member IsAvailable : bool<br />&#160;&#160;static member IsEmulated : bool<br />&#160;&#160;static member RequestRecycle : unit -&gt; unit<br />&#160;&#160;static member Roles : IDictionary&lt;string, Role&gt;<br />&#160;&#160;static event Changing : EventHandler&lt;RoleEnvironmentChangingEventArgs&gt;<br />&#160;&#160;...<br /><br />Full name: Microsoft.WindowsAzure.ServiceRuntime.RoleEnvironment</div>
<div class="tip" id="fs44">property Microsoft.WindowsAzure.ServiceRuntime.RoleEnvironment.CurrentRoleInstance: Microsoft.WindowsAzure.ServiceRuntime.RoleInstance</div>
<div class="tip" id="fs45">property Microsoft.WindowsAzure.ServiceRuntime.RoleInstance.InstanceEndpoints: Collections.Generic.IDictionary&lt;string,Microsoft.WindowsAzure.ServiceRuntime.RoleInstanceEndpoint&gt;</div>
<div class="tip" id="fs46">property Collections.Generic.IDictionary.Keys: Collections.Generic.ICollection&lt;string&gt;</div>
<div class="tip" id="fs47">val serverJob : obj<br /><br />Full name: 200-starting-a-web-server.serverJob</div>
<div class="tip" id="fs48">val suaveServerInCloud : endPointName:&#39;a -&gt; mkApp:&#39;b -&gt; &#39;c<br /><br />Full name: Webserver.suaveServerInCloud</div>

        </div>
        <div class="span3">
          <a href="http://www.m-brace.net/index.html">
            <img src="http://www.m-brace.net/img/mbrace.png" alt="F# Project" style="width:150px;margin:10px" />
          </a>
          <ul class="nav nav-list" id="menu" style="margin-top: 20px;">
            <li class="nav-header">MBrace</li>
            <li><a href="http://www.m-brace.net/index.html">Home page</a></li>
            <li class="divider"></li>
            <li><a href="http://www.nuget.org/packages/MBrace.Core">Get Library via NuGet</a></li>
            <li><a href="http://github.com/mbraceproject/MBrace.Core">Source Code on GitHub</a></li>
            <li><a href="http://github.com/mbraceproject/MBrace.Core/blob/master/LICENSE.md">License</a></li>
            <li><a href="http://github.com/mbraceproject/MBrace.Core/blob/master/RELEASE_NOTES.md">Release Notes</a></li>

            <li class="nav-header">Getting Started</li>
            <li><a href="http://www.m-brace.net/azure-tutorial.html">Azure tutorial</a></li>
            <li class="divider"></li>
            <li><a target="_blank" href="http://skillsmatter.com/skillscasts/5157-mbrace-large-scale-distributed-computation-with-f">Video presentation</a></li>
            <li><a target="_blank" href="http://www.m-brace.net/mbrace-plos.pdf">PLOS'13 Publication</a></li>

            <li class="nav-header">Documentation</li>
            <li><a href="http://www.m-brace.net/programming-model.html">Programming model</a></li>
            <!--<li><a target="_blank" href="http://www.m-brace.net/mbrace-manual.pdf">MBrace Manual</a></li>-->
            <li><a href="http://www.m-brace.net/reference/index.html">API Reference</a></li>
          </ul>
        </div>
      </div>
    </div>
    <a href="http://github.com/mbraceproject/MBrace.Core"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"/></a>
  </body>
  </html>
